<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://nordcdn.net/ds/css/3.1.1/nord.min.css" integrity="sha384-zz2Vh/uaPtnKKnKq4a8aP/R7ybJEZD3LuwnvmLE+p42C+Zjr2R0Y+PKwdABWc61A" crossorigin="anonymous" />
    <script type="module" src="https://nordcdn.net/ds/components/3.8.0/index.js" integrity="sha384-zvZDBl7G/h/0UeesdZH1CBfL9kfoMi+5/I28m8u8yCgzJC7kohDH3I6XgaMzYnLW" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://nordcdn.net/ds/themes/8.0.1/nord-dark.css" integrity="sha384-4mfQkitA1YUssjHukrfVhopnhPw9eM2tX8Z05rZ/5NJRmDJN1fQp2gGfwydx2SzL" crossorigin="anonymous" />
    <link rel="icon" type="image/x-icon" href="./assets/logo.png">
    <title>LinkGuard - Easy Script Monetisation</title>
    <meta name="description" content="Easily earn from scripts behind monitization platforms, hassle free.">
</head>
<body>
    <style>
        body {
            background: var(--n-color-surface);
            margin: 0;
        }

        nord-stack {
            width: 50%;
        }
    </style>
    
    <style>
        @media screen and (max-width: 600px) {
            nord-stack {
                width: 80%;
                flex-direction: column;
            }
        }
    </style>
    
    <nord-header>
        <h1 class="n-typescale-l">Trial Guard</h1>

        <nord-button onclick="serverStatus()" slot="end"><nord-icon name="arrow-up-down-long" slot="end"></nord-icon>Server Status</nord-button>
        <nord-button onclick="getStarted()" variant="primary" slot="end">
          <nord-icon slot="start" name="interface-play"></nord-icon>
          Get Started
        </nord-button>
    </nord-header>

    <nord-empty-state class="n-gap-m">
        <h2>Managing Configuration</h2>
        <p>You are currently managing <%=name%></p>
        <nord-stack justify-content="center" direction="vertical" style="align-items: center;">
            <nord-select name="page-size" value="<%=type%>" label="Type" id="typeselect">
                <option value="script">Script</option>
                <option value="service">Service</option>
            </nord-select>

            <nord-toggle id="pageenabled" label="Page Enabled" value=""></nord-toggle>
            <nord-toggle id="serverlocked" label="Require Server Join" value=""></nord-toggle>
            <nord-range label="Trial Hours" id="hours" value="<%=hours%>" min="1" max="48"></nord-range>
            <nord-input label="Script URL" id="script" value="<%=script%>">
                <nord-icon slot="start" name="interface-globe"></nord-icon>
            </nord-input>
            <nord-input label="Log Webhook" id="webhook" required value="<%=webhook%>">
                <nord-icon slot="start" name="interface-content-book"></nord-icon>
            </nord-input>
            <nord-input label="Discord Invite" id="discord" required  value="<%=discord%>">
                <nord-icon slot="start" name="generic-qr-code"></nord-icon>
            </nord-input>
            <nord-input label="Discord Server ID" id="discordid" required  value="<%=discordid%>">
                <nord-icon slot="start" name="generic-qr-code"></nord-icon>
            </nord-input>
            <nord-input label="Link 1" placeholder="-> /<%=name%>/stage-1" id="linkone" required  value="<%=linkone%>">
                <nord-icon slot="start" name="interface-password"></nord-icon>
            </nord-input>
            <nord-input label="Link 2" placeholder="-> /<%=name%>/stage-2" id="linktwo" required  value="<%=linktwo%>">
                <nord-icon slot="start" name="interface-password"></nord-icon>
            </nord-input>
        </nord-stack>

        <nord-stack justify-content="center" gap="s" direction="horizontal" class="n-margin-l">
            <nord-button variant="primary" onclick="saveConfig()">Save Configuration</nord-button>
        </nord-stack>
    </nord-empty-state>

    <script>
        const serverStatus = () => window.location.href = "https://status.linkguard.cc";
        const getStarted = () => window.location.href = "https://linkguard.cc/join";

        const Hours = document.getElementById("hours");
        const Script = document.getElementById("script");
        const Discord = document.getElementById("discord");
        const Webhook = document.getElementById("webhook");
        const Link1 = document.getElementById("linkone");
        const Link2 = document.getElementById("linktwo");
        const ServerLock = document.getElementById("serverlocked");
        const DiscordID = document.getElementById("discordid");
        const Typed = document.getElementById("typeselect");
        const enabled = document.getElementById("pageenabled");
        ServerLock.checked = '<%=serverlock%>' == '1';
        enabled.checked = '<%=enabled%>' == '1';
        
        async function saveConfig() {
            const response = await fetch("./api/config", {
                method: "POST",
                headers: {
                    ["content-type"]: "application/json",
                    ["tg_access_token"]: "<%=token%>"
                },
                body: JSON.stringify({
                    hours: Hours.value,
                    script: Script.value.trim(),
                    discord: Discord.value.trim(),
                    webhook: Webhook.value.trim(),
                    linkone: Link1.value.trim(),
                    linktwo: Link2.value.trim(),
                    server_lock: ServerLock.checked,
                    discordid: DiscordID.value.trim(),
                    type: Typed.value,
                    enabled: enabled.checked
                })
            })

            const body = await response.json();
            if (body.message) {
                return alert(body.message);
            }

            alert("Updated Successfully!");
        }
    </script>
</body>
</html>